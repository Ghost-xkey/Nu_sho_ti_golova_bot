{% extends "base.html" %}

{% block title %}Настройки - Гриша Bot{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0">
                <i class="fas fa-cog me-2 text-primary"></i>Настройки
            </h1>
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary btn-sm" onclick="refreshSettings()">
                    <i class="fas fa-sync-alt me-1"></i>Обновить
                </button>
                <button type="button" class="btn btn-outline-success btn-sm" onclick="saveSettings()">
                    <i class="fas fa-save me-1"></i>Сохранить
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Settings Tabs -->
<div class="row">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="settingsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">
                            <i class="fas fa-cog me-1"></i>Общие
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="bot-tab" data-bs-toggle="tab" data-bs-target="#bot" type="button" role="tab">
                            <i class="fas fa-robot me-1"></i>Бот
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="video-tab" data-bs-toggle="tab" data-bs-target="#video" type="button" role="tab">
                            <i class="fas fa-video me-1"></i>Видео
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="api-tab" data-bs-toggle="tab" data-bs-target="#api" type="button" role="tab">
                            <i class="fas fa-key me-1"></i>API
                        </button>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content" id="settingsTabContent">
                    <!-- General Settings -->
                    <div class="tab-pane fade show active" id="general" role="tabpanel">
                        <form id="generalSettingsForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="botName" class="form-label">Имя бота</label>
                                        <input type="text" class="form-control" id="botName" value="{{ settings.bot_name }}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="botVersion" class="form-label">Версия</label>
                                        <input type="text" class="form-control" id="botVersion" value="{{ settings.version }}" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="databasePath" class="form-label">Путь к базе данных</label>
                                        <input type="text" class="form-control" id="databasePath" value="{{ settings.database_path }}" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="webPort" class="form-label">Порт веб-интерфейса</label>
                                        <input type="number" class="form-control" id="webPort" value="{{ settings.web_interface_port }}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="timezone" class="form-label">Часовой пояс</label>
                                        <select class="form-select" id="timezone">
                                            <option value="UTC+3" selected>UTC+3 (Москва)</option>
                                            <option value="UTC+2">UTC+2</option>
                                            <option value="UTC+4">UTC+4</option>
                                            <option value="UTC+5">UTC+5</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="language" class="form-label">Язык интерфейса</label>
                                        <select class="form-select" id="language">
                                            <option value="ru" selected>Русский</option>
                                            <option value="en">English</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Bot Settings -->
                    <div class="tab-pane fade" id="bot" role="tabpanel">
                        <form id="botSettingsForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">Поведение бота</h6>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="allowProfanity" checked>
                                            <label class="form-check-label" for="allowProfanity">
                                                Разрешить мат
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="darkHumor" checked>
                                            <label class="form-check-label" for="darkHumor">
                                                Черный юмор
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="movieRecommendations" checked>
                                            <label class="form-check-label" for="movieRecommendations">
                                                Рекомендации фильмов
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="engagementProbability" class="form-label">Вероятность случайного участия (%)</label>
                                        <input type="range" class="form-range" id="engagementProbability" min="0" max="100" value="30">
                                        <div class="form-text">Текущее значение: <span id="engagementValue">30</span>%</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">Настройки ответов</h6>
                                    <div class="mb-3">
                                        <label for="responseDelay" class="form-label">Задержка ответа (сек)</label>
                                        <input type="number" class="form-control" id="responseDelay" value="1" min="0" max="10">
                                    </div>
                                    <div class="mb-3">
                                        <label for="maxResponseLength" class="form-label">Максимальная длина ответа</label>
                                        <input type="number" class="form-control" id="maxResponseLength" value="1000" min="100" max="4000">
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="autoEngage" checked>
                                            <label class="form-check-label" for="autoEngage">
                                                Автоматическое участие в разговорах
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="rememberContext" checked>
                                            <label class="form-check-label" for="rememberContext">
                                                Запоминать контекст разговора
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Video Settings -->
                    <div class="tab-pane fade" id="video" role="tabpanel">
                        <form id="videoSettingsForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">Настройки сохранения видео</h6>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="saveVideos" checked>
                                            <label class="form-check-label" for="saveVideos">
                                                Сохранять видео
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="maxVideoSize" class="form-label">Максимальный размер видео (MB)</label>
                                        <input type="number" class="form-control" id="maxVideoSize" value="50" min="1" max="1000">
                                    </div>
                                    <div class="mb-3">
                                        <label for="videoRetentionDays" class="form-label">Хранить видео (дней)</label>
                                        <input type="number" class="form-control" id="videoRetentionDays" value="30" min="1" max="365">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">Ежедневная отправка</h6>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dailyVideoEnabled" checked>
                                            <label class="form-check-label" for="dailyVideoEnabled">
                                                Включить ежедневную отправку
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="dailyVideoTime" class="form-label">Время отправки</label>
                                        <input type="time" class="form-control" id="dailyVideoTime" value="09:00">
                                    </div>
                                    <div class="mb-3">
                                        <label for="targetChatId" class="form-label">ID целевого чата</label>
                                        <input type="text" class="form-control" id="targetChatId" value="-1002512455884">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sourceChatIds" class="form-label">ID исходных чатов (через запятую)</label>
                                        <input type="text" class="form-control" id="sourceChatIds" value="887092139, 2512455884">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- API Settings -->
                    <div class="tab-pane fade" id="api" role="tabpanel">
                        <form id="apiSettingsForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">API ключи</h6>
                                    <div class="mb-3">
                                        <label for="yandexApiKey" class="form-label">Yandex GPT API ключ</label>
                                        <input type="password" class="form-control" id="yandexApiKey" placeholder="Введите API ключ">
                                        <div class="form-text">Текущий ключ скрыт для безопасности</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="kinopoiskApiKey" class="form-label">Kinopoisk API ключ</label>
                                        <input type="password" class="form-control" id="kinopoiskApiKey" placeholder="Введите API ключ">
                                        <div class="form-text">Текущий ключ скрыт для безопасности</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="telegramBotToken" class="form-label">Telegram Bot Token</label>
                                        <input type="password" class="form-control" id="telegramBotToken" placeholder="Введите токен бота">
                                        <div class="form-text">Текущий токен скрыт для безопасности</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">Статус API</h6>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Yandex GPT</span>
                                            <span class="badge bg-success">Подключен</span>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Kinopoisk API</span>
                                            <span class="badge bg-success">Подключен</span>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Telegram Bot</span>
                                            <span class="badge bg-success">Подключен</span>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <button type="button" class="btn btn-outline-primary" onclick="testApiConnections()">
                                            <i class="fas fa-plug me-1"></i>Тестировать подключения
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Info -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary">Системная информация</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Статистика системы</h6>
                        <p><strong>Время работы:</strong> <span id="uptime">Загрузка...</span></p>
                        <p><strong>Использование памяти:</strong> <span id="memoryUsage">Загрузка...</span></p>
                        <p><strong>Использование CPU:</strong> <span id="cpuUsage">Загрузка...</span></p>
                    </div>
                    <div class="col-md-6">
                        <h6>База данных</h6>
                        <p><strong>Размер БД:</strong> <span id="dbSize">Загрузка...</span></p>
                        <p><strong>Последнее обновление:</strong> <span id="lastUpdate">Загрузка...</span></p>
                        <p><strong>Статус:</strong> <span class="badge bg-success">Онлайн</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Инициализация слайдера
    const engagementSlider = document.getElementById('engagementProbability');
    const engagementValue = document.getElementById('engagementValue');
    
    engagementSlider.addEventListener('input', function() {
        engagementValue.textContent = this.value;
    });
    
    // Загрузка системной информации
    loadSystemInfo();
    
    // Автообновление системной информации каждые 30 секунд
    setInterval(loadSystemInfo, 30000);
});

function refreshSettings() {
    location.reload();
}

function saveSettings() {
    // Собираем данные из всех форм
    const generalData = new FormData(document.getElementById('generalSettingsForm'));
    const botData = new FormData(document.getElementById('botSettingsForm'));
    const videoData = new FormData(document.getElementById('videoSettingsForm'));
    const apiData = new FormData(document.getElementById('apiSettingsForm'));
    
    // Здесь можно добавить API вызов для сохранения настроек
    alert('Функция сохранения настроек в разработке');
}

function testApiConnections() {
    // Здесь можно добавить API вызов для тестирования подключений
    alert('Функция тестирования API в разработке');
}

function loadSystemInfo() {
    // Здесь можно добавить API вызов для получения системной информации
    document.getElementById('uptime').textContent = '2 дня 5 часов';
    document.getElementById('memoryUsage').textContent = '45% (1.2 GB)';
    document.getElementById('cpuUsage').textContent = '12%';
    document.getElementById('dbSize').textContent = '2.3 MB';
    document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
}
</script>
{% endblock %}
